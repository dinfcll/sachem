@using sachem.Models
@model Inscription
@{ var listeJumeleurs = ((sachem.Controllers.JumelageController)ViewContext.Controller)
                                                  .RetourneJumeleurs(Model.id_Inscription, Model.id_TypeInscription, Model.id_Sess);
 }
<script type="text/javascript">
    function RetirerModal(idVu, idJumeleA, vuTypeInsc, nomVu, nomJumeleA) {
        var modal = document.getElementById("modalRetirer");
        var boutonRetirer = document.getElementById("btnRetirer");
        $("#modalRetirerJumeleA").html(nomJumeleA);
        $("#modalRetirerVu").html(nomVu);
        modal.style.display = "block";
        boutonRetirer.onclick = function () {
            Retirer(idVu, idJumeleA, vuTypeInsc);
        }
    }
    function Retirer(idVu, idJumeleA, vuTypeInsc) {
        $.ajax({
            url: "/Jumelage/RetirerJumelage",
            data: { "idVu": idVu, "idJumeleA": idJumeleA, "vuTypeInsc": vuTypeInsc },
            type: "POST",
            success: function () {
                location.reload(true);
            }
        });
    }
</script>
@if (listeJumeleurs.Any())
{
<h4 class="page-header">@Messages.JumeleA</h4>

<table class="table table-striped col-sm-12">
    <tr>
        <th class="col-sm-5">@Html.LabelFor(model => model.Personne.NomPrenom)</th>
        <th class="col-sm-1">@Html.LabelFor(model => model.Personne.Matricule7)</th>
        <th class="col-sm-3">@Messages.PlageHoraire</th>
        <th class="col-sm-3"></th>
    </tr>
    @foreach (var j in listeJumeleurs)
    {
        var plageHoraire = ((sachem.Controllers.JumelageController)ViewContext.Controller)
                                                      .RetournePlageHoraireChaqueJumeleur(Model.id_Inscription, Model.id_TypeInscription, Model.id_Sess, j.id_Inscription);
        foreach(var p in plageHoraire)
        {
            <tr>        
                <td>@j.Personne.NomPrenom</td>
                <td>@j.Personne.Matricule7</td>
                <td>@p</td>
                <td><a href=@j.id_Inscription>@Messages.Consulter</a> | 
                    <a href="#" onclick="RetirerModal(@Model.id_Inscription,@j.id_Inscription,@Model.id_TypeInscription,'@Model.Personne.PrenomNom','@j.Personne.PrenomNom')"
                       data-toggle="modal" data-target="#modalRetirer">@Messages.JumelageSupprimerJumelage
                    </a></td>                
            </tr>
        }
    }
</table>
}
<div class="container">
    <div class="modal fade" id="modalRetirer" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">@Messages.JumelageSupprimerJumelage</h4>
                </div>
                <div class="modal-body">
                    <p>
                        @Messages.JumelageSupprimerQuestion();
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="btnRetirer" type="button" data-dismiss="modal" class="btn btn-primary">@Messages.Supprimer</button>
                    <button type="button" data-dismiss="modal" class="btn">@Messages.Annuler</button>
                </div>
            </div>
        </div>
    </div>
</div>
