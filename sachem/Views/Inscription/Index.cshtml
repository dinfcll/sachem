@model sachem.Models.Inscription

<style>
.checkzone{width:100%;top:-1px;height:25px;background-size:100%; -webkit-appearance: none; -moz-appearance:none;}
</style>
@{
    ViewBag.Title = "Inscription au service de Sachem";
}
<script>
    function suivant() {
        postData = getDisp();
        var modal = document.getElementById('ConfirmDisp');
        var boutonOk = document.getElementById('btnOk');
        postData.forEach(function (disp) {
            var date = new Date(0, 0, 0, 0, 0, 0, 0);
            date.setMinutes(parseInt(disp.substring(disp.indexOf("-") + 1, disp.lentgh)) + 480);
            var heure = date.toTimeString().substring(0, 5);
            disp = disp.substring(0, disp.indexOf("-")) + " " + heure;
        })
        document.getElementById("plageDisp").innerText = postData.jours;
        modal.style.display = 'block';
        
        boutonOk.onclick = function () {
            envoie(postData);
            }
    }
    
    function getDisp() {
        var HoraireArray = [];
        $('[name="horaireCheckbox"]:checked').each(function () {
            HoraireArray.push(($(this).val()));
        });
        var typeinscr = $('#TypeInscription').val();
        var postData = { jours: HoraireArray, typeInscription: typeinscr };
        return postData;
    }

    function envoie(postData) {
        postData = getDisp();
        $.ajax({
            url: "/Inscription/Index",
            data: postData,
            type: "POST",
            traditional: true,
            dataType: 'json',
            success: function (data) {
                alert(data.message);
            }
        });
        return false;
    }
</script>

<div class="container">
<h2>@ViewBag.Title</h2>
<p class="text-success">
    @Html.Raw(@TempData["Success"])
</p>

    @Html.AntiForgeryToken()

    <div class="form-groug">
        @Html.LabelFor(model => model.id_TypeInscription, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.DropDownList("TypeInscription", null, "Choisir", htmlAttributes: new { @class = "form-control" })
            @Html.ValidationMessageFor(model => model.id_TypeInscription, "", new { @class = "text-danger" })
        </div>
    </div>
    <h3 class="page-header">Disponibilité</h3>
    <ul>
        <li>Indiquez vos heures de disponibilité en cliquant dans les cases appropriées.</li>
        <li>Chaque X indique que vous êtes disponible pour une rencontre de 1h30 dans cette plage horaire</li>
        <li>Il y aura au minimum une rencontre par semaine, soit 1h30/semaine</li>
        <li>Inscrivez plusieurs choix pour faciliter le jumelage.</li>
    </ul>
    <form method="post" id="TabDisp">

            @{string[] jour = new string[5] { "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi" };}
        <table class="table-bordered table-striped col-sm-12">
            <tr>
                <th class="col-sm-2 text-center" style="height:30px;font-weight:bold;color:white;background-color:#666;">Heures</th>
                @foreach (string j in jour)
                {
                    <th class="col-sm-2 text-center" style="height:30px;font-weight:bold;color:white;background-color:#666;">@j</th>
                }
            </tr>
            @{ TimeSpan StartTime = TimeSpan.FromHours(8);
                int Difference = 30;
                int Rencontre = 90;
                int EntriesCount = 18;
                Dictionary<TimeSpan, TimeSpan> Entries = new Dictionary<TimeSpan, TimeSpan>();

                for (int i = 0; i < EntriesCount; i++)
                        {
                    Entries.Add(StartTime.Add(TimeSpan.FromMinutes(Difference * i)),//key = debut rencontre
                                StartTime.Add(TimeSpan.FromMinutes(Difference * i + Rencontre)));//value = fin rencontre
                }

                foreach (var e in Entries)
                {
                    double heureCheckbox = e.Key.TotalMinutes - StartTime.TotalMinutes;
                    <tr>
                        <td class="text-center">
                            @(e.Key.Hours)h@(e.Key.Minutes.ToString("00")) - @(e.Value.Hours)h@(e.Value.Minutes.ToString("00"))
                        </td>
                                @for (var j = 0; j < 5; j++)
                                {
                            <td class="text-center"> @Html.CheckBox("horaireCheckbox", false, htmlAttributes: new { @class = "control-label col-md-2 checkzone", @id = jour[j] + heureCheckbox.ToString(), @value = jour[j] + "-" + heureCheckbox.ToString() })</td>
                        }
                    </tr>
                                }
                        }
                    </table>
            <br />
            @Html.Partial("_Boutons")
    </form>
        </div>

<div class="container">
    <div class="modal fade" id="ConfirmDisp" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Confirmation plage de disponibilité</h4>
                </div>
                <div class="modal-body">
                    <p>vos plages de disponibilitées sélectionnées:</p> 
                    <p id="plageDisp"></p>
                </div>
                <div class="modal-footer">
                    <button id="btnOk" type="button" data-dismiss="modal" class="btn btn-primary">Confirmer</button>
                    <button type="button" data-dismiss="modal" class="btn">Annuler</button>
                </div>
            </div>
        </div>
    </div>
</div>